/* jQuery Pathslider v0.9.1 min alpha
 * By Rob Garrison (aka Mottie & Fudgey)
 * Licensed under the MIT License
 */

(function(d){d.pathslider=function(h,k){var a=this,f;a.$el=d(h).addClass("pathslider");a.el=h;a.$el.data("pathslider",a);a.init=function(){var b;a.options=f=d.extend(!0,{},d.pathslider.defaults,k);b=document.createElement("canvas");a.hasCanvas=!(!b.getContext||!b.getContext("2d"));a.hasTouch=document.hasOwnProperty("ontouchend");a.$grip=d("<div></div>").appendTo(a.$el);a.points=f.points;a.pointsxy=a.convert2xy();a.arrayX=[];a.arrayY=[];a.arrayP=[];a.rad2deg=180/Math.PI;a.sliding=!1;a.lastPercent= a.percent=f.value;d.each("create update start slide change stop".split(" "),function(b,i){d.isFunction(f[i])&&a.$el.bind(i+".pathslider",f[i])});d(document).bind(a.hasTouch?"touchend.pathslider touchcancel.pathslider":"mouseup.pathslider mouseleave.pathslider",function(){if(a.sliding&&(a.$el.trigger("stop.pathslider",[a]),a.lastPercent!==a.percent))a.lastPercent=a.percent,a.$el.trigger("change.pathslider",[a]);a.$grip.removeClass("sliding");a.sliding=!1}).bind((a.hasTouch?"touchmove":"mousemove")+ ".pathslider",function(b){a.sliding&&a.setSlider(a.findPos(b),null,!0)});d(window).bind("resize.pathslider",function(){a.update()}).load(function(){a.sliderDim[0]=a.$el.offset().left;a.sliderDim[1]=a.$el.offset().top});a.$grip.bind((a.hasTouch?"touchstart":"mousedown")+".pathslider",function(){a.sliding=!0;d(this).addClass("sliding");a.$el.trigger("start.pathslider",[a]);return!1}).bind("click",function(){return!1});a.update();a.$el.trigger("create.pathslider",[a])};a.update=function(){a.$grip.attr("class", "pathslider-grip "+f.gripClass);a.sliderDim=[a.$el.offset().left,a.$el.offset().top,a.$el.width(),a.$el.height()];a.gripCenter=[a.$grip.width()/2,a.$grip.height()/2];a.dataPoints=f.dataPoints;a.makeArray();var b=d.inArray(a.percent,a.arrayP);a.position=-1===b?Math.round(a.percent/100*a.dataPoints):b;a.setSlider(a.percent,null,!0);a.hasCanvas&&f.useCanvas&&a.drawCurve()};a.setSlider=function(b,c,i){if(!isNaN(b)){var b=parseFloat(b,10),b=100<b?100:0>b?0:b,e;d.inArray(b,a.arrayP);var l=a.calcBezier(b/ 100,a.pointsxy);e=0<b-2?a.calcBezier((b-2)/100,a.pointsxy):l;var g=100>b+2?a.calcBezier((b+2)/100,a.pointsxy):l;e=0===g[0]-e[0]?90:(g[1]-e[1])/(g[0]-e[0]);a.angle=parseInt(Math.atan(e)*a.rad2deg,10);e="rotate("+a.angle+"deg)";e=f.rotateGrip?{"-webkit-transform":e,"-moz-transform":e,"-o-transform":e,"-ms-transform":e,transform:e}:{};e.left=l[0]-a.gripCenter[0];e.top=l[1]-a.gripCenter[1];a.$grip.attr({"data-angle":a.angle,"data-percent":b}).css(e);a.percent=b;(b!==a.lastPercent&&!a.sliding||!i)&&a.$el.trigger("change.pathslider", [a])}"function"===typeof c&&c(a)};a.mousePos=function(b){return[(b.originalEvent.touches?b.originalEvent.touches[0].pageX:b.pageX)-a.sliderDim[0],(b.originalEvent.touches?b.originalEvent.touches[0].pageY:b.pageY)-a.sliderDim[1]]};a.findPos=function(b){for(var c,i,e,d=[],g=[],j=a.position,h=parseInt(f.tolerance+1,10)||2,k=parseInt(f.range,10)||a.gripCenter[0],m=a.mousePos(b),b=0;b<k;b++){d=[];g=[];for(c=0;c<h+1;c++){i=Math.abs(a.arrayX[j+c]-m[0])<=b;e=Math.abs(a.arrayY[j+c]-m[1])<=b;if(i&&e)return a.returnPos(j+ c);i&&d.push(j+c);e&&g.push(j+c);i=Math.abs(a.arrayX[j-c]-m[0])<=b;e=Math.abs(a.arrayY[j-c]-m[1])<=b;if(i&&e)return a.returnPos(j-c);i&&d.push(j-c);e&&g.push(j-c)}if(1===d.length&&1<g.length)return a.returnPos(d[0]);if(1===g.length&&1<d.length)return a.returnPos(g[0])}return a.returnPos(j)};a.returnPos=function(b){var c=a.position===b;a.percent=a.arrayP[b];a.position=b;c||a.$el.trigger("slide.pathslider",[a]);return a.percent};a.makeArray=function(){var b,c,d=a.pointsxy,e=a.dataPoints;for(b=0;b<e+ 1;b++)c=a.calcBezier(b/e,d),a.arrayX[b]=c[0],a.arrayY[b]=c[1],a.arrayP[b]=c[2]};a.calcBezier=function(a,c){var d=a*a,e=1-a,f=e*e,g=e*f,f=3*a*f,e=3*d*e,d=a*d;return[Math.round(c[0]*g+c[2]*f+c[4]*e+c[6]*d),Math.round(c[1]*g+c[3]*f+c[5]*e+c[7]*d),Math.round(1E3*a)/10]};a.convert2xy=function(b){b=b||a.points;return[b[0],b[1],b[0]+b[2],b[1]+b[3],b[6]+b[4],b[7]+b[5],b[6],b[7]]};a.drawCurve=function(){var b,c=a.pointsxy;if(!a.$el.find("canvas").length)d('<canvas class="pathslider-canvas"></canvas>').appendTo(a.$el), a.$canvas=a.$el.find("canvas").attr({width:a.sliderDim[2],height:a.sliderDim[3]}),a.canvas=a.$canvas[0],a.ctx=a.canvas.getContext("2d");b=a.ctx;b.lineCap=f.curve.cap;b.lineJoin=f.curve.cap;b.lineWidth=f.curve.width;b.strokeStyle=f.curve.color;b.beginPath();b.moveTo(c[0],c[1]);b.bezierCurveTo(c[2],c[3],c[4],c[5],c[6],c[7]);b.stroke()};a.init()};d.pathslider.defaults={gripClass:"",rotateGrip:!0,useCanvas:!0,curve:{width:4,color:"#333",cap:"round"},points:[0,50,50,-50,-50,-50,250,50],value:50,dataPoints:100, tolerance:3,range:30};d.fn.pathslider=function(h,k){return this.each(function(){var a,f=d(this).data("pathslider");if((typeof h).match("object|undefined")){if(f)return f.update();new d.pathslider(this,h)}else/\d/.test(h)&&!isNaN(h)&&f&&(a="number"===typeof h?h:parseInt(d.trim(h),10),0<=a&&100>=a&&f.setSlider(a,k))})};d.fn.getpathslider=function(){return this.data("pathslider")}})(jQuery);
